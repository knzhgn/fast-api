# FastAPI: Проект с Пагинацией и Фильтрацией Заметок

Проект на **FastAPI**, реализующий систему управления заметками (`Note`) с использованием **SQLAlchemy** и **SQLModel** для работы с базой данных. Особенности включают пагинацию, фильтрацию и аутентификацию через **JWT-токены**.

## Описание

Данный проект демонстрирует современный подход к разработке REST API с акцентом на:

- **Аутентификацию пользователя**: Использование **JWT-токенов** для защиты эндпоинтов.
- **Управление заметками**: Поддержка CRUD-операций (создание, чтение, обновление, удаление) для заметок, привязанных к пользователю.
- **Пагинация**: Эндпоинт `/notes` поддерживает выборку заметок с параметрами `skip` и `limit`.
- **Фильтрация**: Возможность поиска заметок по содержимому с параметром `search`.

## Требования

Перед началом работы убедитесь, что установлены следующие компоненты:

- **Python 3.7+**
- **PostgreSQL** (или другая база данных, совместимая с SQLAlchemy)

### Зависимости

Установите все необходимые зависимости с помощью команды:
```bash
pip install -r requirements.txt
```

Список зависимостей:
- **`fastapi`**: Веб-фреймворк для создания API.
- **`uvicorn`**: ASGI-сервер для запуска приложения.
- **`sqlmodel`**: ORM-библиотека для работы с базой данных.
- **`asyncpg`**: Асинхронный драйвер для PostgreSQL (если используется).
- **`passlib`**: Библиотека для хеширования паролей (схема **bcrypt**).
- **`python-jose`**: Инструмент для создания и проверки **JWT-токенов**.

## Настройка базы данных

1. **Установка PostgreSQL**:  
   Установите PostgreSQL локально или используйте облачное решение, например, [ElephantSQL](https://www.elephantsql.com/).

2. **Создание базы данных**:  
   Создайте базу данных с именем `notesdb` (или обновите строку подключения в коде под свои параметры).

3. **Автоматическое создание таблиц**:  
   Приложение автоматически создаёт таблицы `notes` и `user` при первом запуске. Для ручного создания выполните:
   ```python
   from database import create_db_and_tables
   create_db_and_tables()
   ```

## Запуск приложения

Запустите сервер локально с помощью команды:
```bash
uvicorn main:app --reload
```

- Сервер будет доступен по адресу: [http://127.0.0.1:8000](http://127.0.0.1:8000).
- Флаг `--reload` обеспечивает автоматическую перезагрузку при изменении кода.

## Эндпоинты API

### 1. **POST `/register`**
- **Описание**: Регистрация нового пользователя.
- **Тело запроса** (JSON):
  ```json
  {
    "username": "exampleuser",
    "password": "password123"
  }
  ```
- **Ответ** (JSON):
  ```json
  {
    "id": 1,
    "username": "exampleuser",
    "role": "user"
  }
  ```

### 2. **POST `/login`**
- **Описание**: Аутентификация и получение **JWT-токена**.
- **Тело запроса** (JSON):
  ```json
  {
    "username": "exampleuser",
    "password": "password123"
  }
  ```
- **Ответ** (JSON):
  ```json
  {
    "access_token": "jwt_token_here",
    "token_type": "bearer"
  }
  ```

### 3. **GET `/notes`**
- **Описание**: Получение списка заметок текущего пользователя с поддержкой пагинации и фильтрации.
- **Параметры запроса**:
  - `skip` (опционально): Количество пропускаемых записей (по умолчанию 0).
  - `limit` (опционально): Ограничение количества возвращаемых записей.
  - `search` (опционально): Фильтрация по содержимому заметок.
- **Пример запроса**:
  ```http
  GET /notes?skip=10&limit=10&search=important
  ```
- **Ответ** (JSON):
  ```json
  [
    {
      "id": 1,
      "text": "Important note about FastAPI",
      "created_at": "2025-06-04T14:35:00+05:00",
      "owner_id": 1
    }
  ]
  ```
- **Требования**: Заголовок `Authorization: Bearer <JWT-токен>`.

## Тестирование через Postman

Для тестирования эндпоинтов выполните следующие шаги:

1. **Запуск сервера**:  
   Убедитесь, что сервер запущен:
   ```bash
   uvicorn main:app --reload
   ```

2. **Тестирование эндпоинта `/notes`**:
   - **GET `/notes`**: Возвращает первые заметки без параметров:
     - **Метод**: `GET`
     - **URL**: `http://127.0.0.1:8000/notes`
     - **Заголовок**: `Authorization: Bearer <JWT-токен>`
   - **GET `/notes?skip=10&limit=10`**: Возвращает 10 заметок, начиная с 11-й:
     - **Метод**: `GET`
     - **URL**: `http://127.0.0.1:8000/notes?skip=10&limit=10`
     - **Заголовок**: `Authorization: Bearer <JWT-токен>`
   - **GET `/notes?search=some_text`**: Фильтрация по содержимому:
     - **Метод**: `GET`
     - **URL**: `http://127.0.0.1:8000/notes?search=some_text`
     - **Заголовок**: `Authorization: Bearer <JWT-токен>`

3. **Проверка аутентификации**:  
   Добавьте заголовок для всех защищённых эндпоинтов:
   - **Key**: `Authorization`
   - **Value**: `Bearer <your_token>`
   (где `<your_token>` — токен, полученный при входе).

## Примечания

- **Безопасность**: Пароли хешируются с использованием **bcrypt**, а доступ ограничен владельцем заметки.
- **Автоматические миграции**: Таблицы создаются при запуске, но для сложных изменений рекомендуется использовать **Alembic**.
- **Документация**: Доступна через **Swagger UI** по адресу `/docs`.

## Контакты

Если у вас возникнут вопросы или потребуется помощь, пишите мне в **Microsoft Teams**.