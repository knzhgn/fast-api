# API Регистрации и Входа Пользователей на FastAPI

Простой API для регистрации новых пользователей и аутентификации в системе. Учетные данные (имя пользователя и пароль) хранятся в базе данных **PostgreSQL** в открытом виде (без хэширования) — реализация предназначена исключительно для учебных целей. Проект построен на **FastAPI**, **SQLModel** (на основе **SQLAlchemy**) и **asyncpg**.

## Описание

Этот учебный проект демонстрирует основы создания REST API с использованием **FastAPI** и асинхронного взаимодействия с базой данных **PostgreSQL** через **SQLModel**.

## Технологии

- **Python 3.10+**
- **FastAPI**
- **Uvicorn** (ASGI-сервер)
- **PostgreSQL**
- **SQLModel** (ORM на базе SQLAlchemy)
- **asyncpg** (асинхронный драйвер для PostgreSQL)
- **Pydantic** (валидация данных)
- **psycopg2-binary** (дополнительный драйвер для совместимости)

## Установка и запуск

1. **Клонирование или создание проекта**:  
   Клонируйте репозиторий или настройте новый проект.

2. **Создание и активация виртуального окружения**:  
   - Создайте окружение:
     ```bash
     python -m venv .venv
     ```
   - Активируйте окружение:
     - Для Linux/macOS:
       ```bash
       source .venv/bin/activate
       ```
     - Для Windows:
       ```bash
       .venv\Scripts\activate
       ```

3. **Установка зависимостей**:  
   Установите необходимые пакеты:
   ```bash
   pip install fastapi uvicorn sqlmodel asyncpg psycopg2-binary
   ```

4. **Настройка PostgreSQL**:  
   Убедитесь, что сервер **PostgreSQL** запущен, и создайте базу данных `notesdb` с пользователем `postgres` и паролем `123` (или измените `DATABASE_URL` в коде под свои параметры).

5. **Запуск приложения**:  
   Запустите сервер:
   ```bash
   uvicorn main:app --reload
   ```

## Описание эндпоинтов

### POST /register
- **Описание**: Регистрация нового пользователя.
- **Принимает**: JSON с полями:
  - `username` (строка, уникальное имя пользователя).
  - `password` (строка).
- **Возвращает**: JSON с данными зарегистрированного пользователя:
  - `id` (число).
  - `username` (строка).
- **Ошибки**:
  - `400 Bad Request` — если имя пользователя уже существует.

### POST /login
- **Описание**: Аутентификация пользователя.
- **Принимает**: JSON с полями:
  - `username` (строка).
  - `password` (строка).
- **Возвращает**: JSON с сообщением об успешном входе и именем пользователя.
- **Ошибки**:
  - `401 Unauthorized` — если пользователь не найден или пароль неверный.

## Пример запросов

### Регистрация пользователя
- **Метод**: POST
- **URL**: `http://127.0.0.1:8000/register`
- **Content-Type**: `application/json`
- **Тело (JSON)**:
  ```json
  {
    "username": "testuser",
    "password": "mypassword"
  }
  ```

### Вход пользователя
- **Метод**: POST
- **URL**: `http://127.0.0.1:8000/login`
- **Content-Type**: `application/json`
- **Тело (JSON)**:
  ```json
  {
    "username": "testuser",
    "password": "mypassword"
  }
  ```

## Особенности и рекомендации

- **Хранение паролей**: Пароли хранятся в базе данных в открытом виде — это сделано для учебных целей. В реальных проектах используйте хэширование (например, библиотеку `bcrypt`).
- **Методы запросов**: Эндпоинты `/register` и `/login` поддерживают только **POST**-запросы.
- **Обработка ошибок**: API возвращает соответствующие HTTP-статусы и сообщения при ошибках регистрации или входа.
- **Тестирование**: Используйте **Postman** или **curl** для удобного тестирования.
- **Автоматическое создание таблиц**: При первом запуске таблицы создаются автоматически.

## Структура проекта

- **`main.py`**: Основной файл с кодом приложения.
- **Модели и схемы**: 
  - `User` (модель **SQLModel**).
  - Схемы **Pydantic**: `UserCreate`, `UserLogin`, `UserRead`.
- **Подключение к базе**: Асинхронное подключение к **PostgreSQL** через **asyncpg**.
- **Создание таблиц**: Таблицы создаются автоматически при старте приложения.

## Полезные команды

- **Запуск сервера**:  
  ```bash
  uvicorn main:app --reload
  ```
- **Установка зависимостей**:  
  ```bash
  pip install -r requirements.txt
  ```
  *(Команда применима, если файл `requirements.txt` создан.)*

## Контакты

Если у вас есть вопросы или предложения, открывайте Microsft Teams и пишите туда.