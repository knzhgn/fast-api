# FastAPI API: Регистрация, Логин и Защита Эндпоинтов через JWT

REST API на основе **FastAPI** с функционалом регистрации и входа пользователей, безопасным хранением паролей и защитой эндпоинтов с использованием **JWT-токенов**.

## Описание

Этот проект демонстрирует реализацию REST API с **FastAPI**, включающую регистрацию пользователей, аутентификацию с выдачей **JWT-токенов** и защиту эндпоинтов. Пароли хранятся в виде **bcrypt**-хешей, а доступ к защищённым маршрутам возможен только при наличии валидного токена.

## Технологии

- **Python 3.10+**
- **FastAPI**
- **Uvicorn** (ASGI-сервер)
- **PostgreSQL**
- **SQLModel** / **SQLAlchemy** (ORM)
- **Passlib** (схема **bcrypt** для хеширования паролей)
- **python-jose** (с поддержкой **cryptography** для работы с JWT)
- **asyncpg** (асинхронный драйвер для PostgreSQL)

## Установка

1. **Клонирование или создание проекта**:  
   Клонируйте репозиторий или создайте новую папку для проекта.

2. **Создание и активация виртуального окружения**:  
   - Создайте окружение:
     ```bash
     python -m venv .venv
     ```
   - Активируйте окружение:
     - Для Linux/macOS:
       ```bash
       source .venv/bin/activate
       ```
     - Для Windows:
       ```bash
       .venv\Scripts\activate
       ```

3. **Установка зависимостей**:  
   Установите необходимые пакеты:
   ```bash
   pip install fastapi uvicorn sqlmodel asyncpg psycopg2-binary passlib[bcrypt] "python-jose[cryptography]"
   ```

## Настройка подключения к базе данных

В файле `main.py` обновите строку подключения, указав свои данные:
```python
DATABASE_URL = "postgresql+asyncpg://username:password@localhost:5432/notesdb"
```
Замените `username`, `password` и имя базы данных (`notesdb`) на свои.

## Запуск

Запустите сервер:
```bash
uvicorn main:app --reload
```

После запуска документация API доступна по адресу:  
- **Swagger UI**: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)  
- **ReDoc**: [http://127.0.0.1:8000/redoc](http://127.0.0.1:8000/redoc)

## Эндпоинты API

### POST /register
- **Описание**: Регистрация нового пользователя.
- **Тело запроса** (JSON):
  ```json
  {
    "username": "your_username",
    "password": "your_password"
  }
  ```
- **Ответ** (JSON):
  ```json
  {
    "id": 1,
    "username": "your_username"
  }
  ```

### POST /login
- **Описание**: Аутентификация пользователя.
- **Тело запроса** (JSON):
  ```json
  {
    "username": "your_username",
    "password": "your_password"
  }
  ```
- **Ответ** (JSON) при успехе:
  ```json
  {
    "access_token": "jwt_token_string",
    "token_type": "bearer"
  }
  ```
- **Ошибки**: `401 Unauthorized` — при неверных данных пользователя или пароле.

### GET /users/me
- **Описание**: Получение данных текущего пользователя.
- **Требуемый заголовок**:
  ```
  Authorization: Bearer <jwt_token>
  ```
- **Ответ** (JSON):
  ```json
  {
    "id": 1,
    "username": "your_username"
  }
  ```
- **Ошибки**: `401 Unauthorized` — при отсутствии или недействительности токена.

## Тестирование

- **Рекомендации**: Используйте **Swagger UI**, **ReDoc** или **Postman** для тестирования.
- **Проверяйте**:
  - Регистрацию нового пользователя.
  - Аутентификацию и получение JWT-токена.
  - Доступ к защищённому эндпоинту `/users/me` с использованием токена в заголовке `Authorization`.

## Безопасность

- **Хеширование паролей**: Пароли хранятся в виде **bcrypt**-хешей.
- **JWT-токены**: Токены подписаны секретным ключом и имеют ограниченное время жизни (по умолчанию — 30 минут).
- **Защита эндпоинтов**: Доступ к защищённым маршрутам, таким как `/users/me`, возможен только с валидным токеном.
- **Рекомендации**: Храните секретный ключ (`SECRET_KEY`) в переменных окружения и не раскрывайте его.

## Контакты

Если вам нужна помощь с расширением функционала или есть вопросы, пишите мне в **Microsoft Teams**.